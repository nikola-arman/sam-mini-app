<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sam Charts ðŸ“Š</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg: var(--tg-theme-bg-color, #1a1a2e);
      --bg2: var(--tg-theme-secondary-bg-color, #16213e);
      --text: var(--tg-theme-text-color, #ffffff);
      --hint: var(--tg-theme-hint-color, #888888);
      --accent: var(--tg-theme-button-color, #7c3aed);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .subtitle {
      font-size: 14px;
      color: var(--hint);
    }
    
    .chart-container {
      background: var(--bg2);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .chart-wrapper {
      position: relative;
      height: 250px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: var(--bg2);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--hint);
      margin-top: 4px;
    }
    
    .stat-change {
      font-size: 12px;
      margin-top: 4px;
    }
    
    .stat-change.up { color: #10b981; }
    .stat-change.down { color: #ef4444; }
    
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: var(--hint);
    }
    
    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid #ef4444;
      color: #ef4444;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title" id="title">ðŸ“Š Chart</div>
      <div class="subtitle" id="subtitle"></div>
    </div>
    
    <div class="chart-container">
      <div class="chart-wrapper">
        <canvas id="chart"></canvas>
      </div>
    </div>
    
    <div class="stats" id="stats"></div>
    
    <div class="footer">
      <span id="footer">Generated by Sam ðŸ¦ž</span>
    </div>
  </div>
  
  <div class="container" id="errorContainer" style="display: none;">
    <div class="error" id="errorMessage"></div>
  </div>

  <script>
    // Initialize Telegram WebApp
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
    }
    
    // Parse data from URL
    function getChartData() {
      const params = new URLSearchParams(window.location.search);
      const dataParam = params.get('data');
      
      if (!dataParam) {
        // Demo data if no params
        return {
          type: 'line',
          title: 'Daily Revenue',
          subtitle: 'Last 7 days',
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Revenue ($)',
            data: [4200, 3800, 5100, 4900, 5200, 4700, 5847],
            borderColor: '#7c3aed',
            backgroundColor: 'rgba(124, 58, 237, 0.1)',
            fill: true,
            tension: 0.4
          }],
          stats: [
            { label: 'Total', value: '$33,747', change: '+12%', up: true },
            { label: 'Average', value: '$4,821', change: '+8%', up: true },
            { label: 'Peak', value: '$5,847', change: 'Sun', up: true },
            { label: 'Low', value: '$3,800', change: 'Tue', up: false }
          ]
        };
      }
      
      try {
        return JSON.parse(atob(dataParam));
      } catch (e) {
        throw new Error('Invalid chart data');
      }
    }
    
    // Render chart
    function renderChart(data) {
      // Set title
      document.getElementById('title').textContent = data.title || 'ðŸ“Š Chart';
      document.getElementById('subtitle').textContent = data.subtitle || '';
      
      // Chart colors based on theme
      const textColor = getComputedStyle(document.body).getPropertyValue('--text').trim() || '#ffffff';
      const hintColor = getComputedStyle(document.body).getPropertyValue('--hint').trim() || '#888888';
      
      // Default dataset styling
      const defaultColors = ['#7c3aed', '#10b981', '#f59e0b', '#ef4444', '#3b82f6'];
      
      const datasets = (data.datasets || [{ data: data.values }]).map((ds, i) => ({
        label: ds.label || 'Data',
        data: ds.data || ds.values || [],
        borderColor: ds.borderColor || defaultColors[i % defaultColors.length],
        backgroundColor: ds.backgroundColor || `${defaultColors[i % defaultColors.length]}22`,
        fill: ds.fill !== undefined ? ds.fill : (data.type === 'line'),
        tension: ds.tension || 0.4,
        borderWidth: 2
      }));
      
      // Create chart
      const ctx = document.getElementById('chart').getContext('2d');
      new Chart(ctx, {
        type: data.type || 'line',
        data: {
          labels: data.labels || [],
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: datasets.length > 1,
              labels: { color: textColor }
            }
          },
          scales: {
            x: {
              ticks: { color: hintColor },
              grid: { color: 'rgba(255,255,255,0.05)' }
            },
            y: {
              ticks: { color: hintColor },
              grid: { color: 'rgba(255,255,255,0.05)' }
            }
          }
        }
      });
      
      // Render stats
      if (data.stats && data.stats.length > 0) {
        const statsHtml = data.stats.map(s => `
          <div class="stat-card">
            <div class="stat-value">${s.value}</div>
            <div class="stat-label">${s.label}</div>
            ${s.change ? `<div class="stat-change ${s.up ? 'up' : 'down'}">${s.up ? 'â†‘' : 'â†“'} ${s.change}</div>` : ''}
          </div>
        `).join('');
        document.getElementById('stats').innerHTML = statsHtml;
      }
      
      // Footer
      if (data.footer) {
        document.getElementById('footer').textContent = data.footer;
      }
    }
    
    // Show error
    function showError(message) {
      document.querySelector('.container').style.display = 'none';
      document.getElementById('errorContainer').style.display = 'block';
      document.getElementById('errorMessage').textContent = message;
    }
    
    // Initialize
    try {
      const data = getChartData();
      renderChart(data);
    } catch (e) {
      showError(e.message);
    }
  </script>
</body>
</html>
